<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>My WebAR Pro - Stage 2.5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- مكتبات -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://rawcdn.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: radial-gradient(circle at top, #001628, #000);
        font-family: 'Poppins', sans-serif;
      }

      /* واجهة الروابط */
      .links {
        position: fixed;
        top: 50%;
        right: 6%;
        transform: translateY(-50%);
        width: 220px;
        background: rgba(0, 60, 150, 0.25);
        border: 1px solid rgba(0, 180, 255, 0.3);
        border-radius: 16px;
        backdrop-filter: blur(10px);
        padding: 15px 10px;
        box-shadow: 0 0 20px rgba(0, 120, 255, 0.25);
      }

      .links h3 {
        text-align: center;
        color: #00d4ff;
        margin: 6px 0 12px;
        font-weight: 600;
        font-size: 17px;
      }

      .link {
        display: block;
        margin: 8px 0;
        text-decoration: none;
        color: #fff;
        background: rgba(0, 80, 180, 0.45);
        border-radius: 10px;
        padding: 8px;
        text-align: center;
        transition: all 0.3s;
      }

      .link:hover {
        background: rgba(0, 190, 255, 0.8);
        color: #000;
        transform: scale(1.05);
      }
    </style>
  </head>

  <body>
    <!-- مشهد الواقع -->
    <a-scene
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
    >
      <!-- الماركر -->
      <a-marker
        type="pattern"
        url="marker.patt"
        id="marker"
      ></a-marker>

      <!-- المجسم (خارج الماركر حتى يثبت بالعالم) -->
      <a-entity
        id="myModel"
        gltf-model="3d-2.glb"
        visible="false"
        scale="0.6 0.6 0.6"
        position="0 0 0"
        rotation="0 0 0"
      ></a-entity>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- واجهة الروابط -->
    <div class="links">
      <h3>مشروع تِمو</h3>
      <a class="link" href="https://example.com/shop" target="_blank">المتجر</a>
      <a class="link" href="https://example.com/video" target="_blank">الفيديو</a>
      <a class="link" href="https://t.me/example" target="_blank">تواصل</a>
    </div>

    <script>
      const marker = document.querySelector("#marker");
      const model = document.querySelector("#myModel");
      let anchored = false;

      // أول مرة يشوف الماركر
      marker.addEventListener("markerFound", () => {
        if (anchored) return;
        const marker3D = marker.object3D;
        const pos = new THREE.Vector3();
        marker3D.getWorldPosition(pos);
        const rot = new THREE.Euler();
        rot.copy(marker3D.rotation);

        // نخلي المجسم بنفس المكان
        model.object3D.position.copy(pos);
        model.object3D.rotation.copy(rot);
        model.setAttribute("visible", true);
        anchored = true;
        console.log("Model anchored at:", pos);
      });

      // سحب بالإصبع لتغيير الموقع
      let dragging = false;
      let lastX = 0, lastY = 0;

      window.addEventListener("touchstart", (e) => {
        dragging = true;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      });

      window.addEventListener("touchmove", (e) => {
        if (!dragging || !anchored) return;
        const dx = (e.touches[0].clientX - lastX) / 200;
        const dy = (e.touches[0].clientY - lastY) / 200;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
        // نحرك المجسم بالعالم (بشكل بسيط)
        model.object3D.position.x += dx;
        model.object3D.position.z += dy;
      });

      window.addEventListener("touchend", () => {
        dragging = false;
      });
    </script>
  </body>
</html>
